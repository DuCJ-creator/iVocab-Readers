<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shirley's Interactive iVocab Reader</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --bg-deep: #050510;
            --glass-bg: rgba(15, 15, 25, 0.85);
            --gold-gradient: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --gold-text: #FDB931; 
            --gold-border: rgba(255, 215, 0, 0.3);
            --text-main: #e0e0e0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: var(--bg-deep);
            font-family: 'Lato', sans-serif;
            color: var(--text-main);
            overflow-x: hidden;
            min-height: 100vh;
        }

        #galaxy-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        .app-container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 30px;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--gold-border);
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 0 20px rgba(191,149,63,0.1);
            position: relative;
        }

        header { text-align: center; margin-bottom: 40px; border-bottom: 2px solid transparent; border-image: var(--gold-gradient) 1; padding-bottom: 20px; }
        h1 { font-family: 'Cinzel', serif; font-size: 2.5rem; background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        select, input {
            width: 100%; padding: 12px; background: rgba(255,255,255,0.05);
            border: 1px solid var(--gold-border); border-radius: 8px; color: var(--gold-text);
            font-size: 1rem; outline: none; transition: 0.3s;
        }
        select:focus, input:focus { box-shadow: 0 0 10px rgba(191,149,63,0.4); border-color: #fcf6ba; }

        .quiz-section { display: none; margin-top: 30px; }
        .question-card { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #bf953f; }
        .question-text { font-size: 1.1rem; margin-bottom: 15px; color: #fff; line-height: 1.6; }
        .options-grid { display: grid; gap: 10px; }
        .option-label {
            display: flex; align-items: center; padding: 10px; background: rgba(255,255,255,0.05);
            border-radius: 6px; cursor: pointer; transition: 0.2s;
        }
        .option-label:hover { background: rgba(191,149,63,0.15); }
        .option-label input { width: auto; margin-right: 15px; cursor: pointer; }

        .btn-main {
            display: block; width: 100%; padding: 15px; margin-top: 20px;
            background: var(--gold-gradient); border: none; border-radius: 10px;
            color: #000; font-family: 'Cinzel', serif; font-weight: 700; font-size: 1.1rem;
            cursor: pointer; transition: 0.4s; text-transform: uppercase;
        }
        .btn-main:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(191,149,63,0.4); }

        .feedback { margin-top: 10px; font-weight: bold; display: none; }
        .correct { color: #4CAF50; }
        .incorrect { color: #FF5252; }

        #results-container { display: none; text-align: center; padding: 20px; margin-top: 20px; border: 2px solid var(--gold-text); border-radius: 15px; }
    </style>
</head>
<body>
    <canvas id="galaxy-bg"></canvas>

    <div class="app-container" id="main-app">
        <header>
            <h1>iVocab Reader Èñ±ËÆÄÁêÜËß£</h1>
            <p style="color: var(--gold-text)">Interactive Learning Experience</p>
        </header>

        <div class="controls">
            <div>
                <label style="display:block; margin-bottom:5px;">Target Unit</label>
                <select id="unit-select" onchange="loadUnit()">
                    <option value="">Select Unit...</option>
                    <option value="1">Unit 1: Global Warming</option>
                    <option value="2">Unit 2: Artificial Intelligence</option>
                </select>
            </div>
            <div>
                <label style="display:block; margin-bottom:5px;">Student Name</label>
                <input type="text" id="input-name" placeholder="Enter your name">
            </div>
        </div>

        <div id="quiz-area" class="quiz-section">
            <div id="questions-container"></div>
            <button id="submit-btn" class="btn-main" onclick="submitQuiz()">Submit All Answers</button>
        </div>

        <div id="results-container">
            <h2 style="font-family:Cinzel; color:var(--gold-text);">Mission Accomplished!</h2>
            <p style="font-size:1.5rem; margin:15px 0;">Your Score: <span id="final-score">0 / 5</span></p>
            <p>ÊúàÂÖâÈªûÊï∏Â∑≤Ëá™Âãï‰∏äÂÇ≥Ëá≥ÂØ∂Áõí üåô</p>
        </div>
    </div>

    <script>
        const STATE = {
            currentQuestions: [],
            userAnswers: {},
            units: {
                "1": [
                    { q: "What is the main cause of global warming mentioned?", options: ["A. Ocean currents", "B. Greenhouse gas emissions", "C. Solar flares", "D. Volcanic activity"], answer: "B" },
                    { q: "Which gas is most responsible for the greenhouse effect?", options: ["A. Oxygen", "B. Nitrogen", "C. Carbon Dioxide", "D. Helium"], answer: "C" },
                    { q: "What is a likely consequence of rising sea levels?", options: ["A. Coastal flooding", "B. More desert land", "C. Lower global temperatures", "D. Decreased rainfall"], answer: "A" },
                    { q: "How can individuals help reduce global warming?", options: ["A. Use more plastic", "B. Drive alone always", "C. Reduce energy consumption", "D. Waste more water"], answer: "C" },
                    { q: "What do scientists use to track climate change?", options: ["A. Satellite data", "B. Guesswork", "C. Old myths", "D. Wind speed only"], answer: "A" }
                ],
                "2": [
                    { q: "What does AI stand for?", options: ["A. Actual Intelligence", "B. Artificial Intelligence", "C. Automated Interaction", "D. Advanced Integration"], answer: "B" },
                    { q: "Which is a common application of AI?", options: ["A. Manual typewriters", "B. Face recognition", "C. Paper maps", "D. Hand-cranked fans"], answer: "B" },
                    { q: "What is machine learning?", options: ["A. Machines cleaning themselves", "B. Computers learning from data", "C. Building metal robots", "D. Manual data entry"], answer: "B" },
                    { q: "Who is considered a pioneer of AI?", options: ["A. Alan Turing", "B. Napoleon", "C. Shakespeare", "D. Beethoven"], answer: "A" },
                    { q: "A risk of AI development is...", options: ["A. Better healthcare", "B. Privacy concerns", "C. Faster calculations", "D. Improved efficiency"], answer: "B" }
                ]
            }
        };

        function initGalaxy() {
            const canvas = document.getElementById('galaxy-bg');
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({ color: 0xFFD700, size: 0.02 });
            const starVertices = [];
            for (let i = 0; i < 6000; i++) {
                starVertices.push((Math.random() - 0.5) * 20, (Math.random() - 0.5) * 20, (Math.random() - 0.5) * 20);
            }
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);

            function animate() {
                requestAnimationFrame(animate);
                stars.rotation.y += 0.001;
                renderer.render(scene, camera);
            }
            animate();
        }

        function loadUnit() {
            const unitId = document.getElementById('unit-select').value;
            if (!unitId) return;
            
            STATE.currentQuestions = STATE.units[unitId];
            STATE.userAnswers = {};
            
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            STATE.currentQuestions.forEach((q, idx) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.innerHTML = `
                    <p class="question-text">${idx + 1}. ${q.q}</p>
                    <div class="options-grid">
                        ${q.options.map(opt => `
                            <label class="option-label">
                                <input type="radio" name="q${idx}" value="${opt[0]}" onchange="recordAnswer(${idx}, '${opt[0]}')">
                                ${opt}
                            </label>
                        `).join('')}
                    </div>
                    <div id="feedback-${idx}" class="feedback"></div>
                `;
                container.appendChild(card);
            });
            
            document.getElementById('quiz-area').style.display = 'block';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('submit-btn').style.display = 'block';
        }

        function recordAnswer(qIdx, val) {
            STATE.userAnswers[qIdx] = val;
        }

        function submitQuiz() {
            let score = 0;
            let answeredCount = 0;
            
            STATE.currentQuestions.forEach((q, idx) => {
                const fb = document.getElementById(`feedback-${idx}`);
                fb.style.display = 'block';
                const userVal = STATE.userAnswers[idx];
                
                if (userVal) {
                    answeredCount++;
                    const isCorrect = userVal === q.answer.trim().toUpperCase();
                    if (isCorrect) score++;
                    fb.innerHTML = isCorrect ? 
                        `<span class="correct">‚úì Correct</span>` : 
                        `<span class="incorrect">‚úó Incorrect. Answer: ${q.answer}</span>`;
                } else {
                    fb.innerHTML = `<span class="incorrect">Not Answered</span>`;
                }
                
                const labels = document.querySelectorAll(`input[name="q${idx}"]`);
                labels.forEach(l => l.parentElement.style.pointerEvents = 'none');
            });

            if (answeredCount < 5) {
                if(!confirm("Not all questions answered. Submit anyway?")) return;
            }

            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('final-score').textContent = `${score} / 5`;
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });

            // --- Ê†∏ÂøÉ‰øÆÊ≠£ÔºöÂõûÂÇ≥ÈªûÊï∏Áµ¶ÊúàÂÖâÂØ∂Áõí ---
            if (window.parent) {
                window.parent.postMessage({
                    type: "LUNAR_MISSION_RESULT", 
                    mission: "Mission 3: iVocab Reader Èñ±ËÆÄÁêÜËß£",
                    correct: score,
                    total: 5
                }, "*");
                console.log("Mission 3 Result Sent:", score);
            }
        }

        initGalaxy();
    </script>
</body>
</html>
